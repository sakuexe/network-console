---
import Layout from '../layouts/Layout.astro'
import Devices from './_devices.astro'
import getApiUrl from '../utils/apiurl'

const currentDate = new Date().toLocaleDateString('fi-FI')

let publicIp = 'unknown IP'
let localIp = 'unknown IP'

try {
  const response = await fetch('https://api.ipify.org?format=json')
  if (!response.ok) {
    console.error('Error fetching IP')
    return
  }
  const data = await response.json()
  publicIp = data.ip
  const localResponse = await fetch(`${getApiUrl()}/ip`)
  if (!localResponse.ok) {
    console.error('Error fetching local IP')
    return
  }
  const localData = await localResponse.json()
  localIp = localData.ip
  } catch (error) {
    console.error(error)
  }
---

<Layout title="Tllabra devices" showFooter>
  <header class="container">
    <h1>Tllabra <span>{currentDate}</span></h1>
    <p>List of devices in the network</p>
    <p>Public IP: <span class="text-bold">{publicIp}</span></p>
    <p>Local IP: <span class="text-bold">{localIp}</span></p>
  </header>
  <Devices />
</Layout>

<style>
  p > span {
    user-select: all;
  }
</style>
